<bound method Tag.prettify of <article class="md-content__inner md-typeset">
<h1 id="lecture-15-the-having-operator-the-limit-operator-table-constraints-having-limit">Lecture 15. The <code>HAVING</code> Operator, The <code>LIMIT</code> Operator, Table Constraints 运算符 <code>HAVING</code>、运算符 <code>LIMIT</code>、表限制</h1>
<p>~~那天我在睡大觉，旷课了~~</p>
<h2 id="having"><code>HAVING</code> 语法</h2>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-0-1"><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">&lt;</span><span class="n">colName</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="o">&lt;</span><span class="n">aggFunc</span><span class="p">()</span><span class="o">&gt;</span>
</span><span id="__span-0-2"><a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="w">    </span><span class="k">FROM</span><span class="w"> </span><span class="o">&lt;</span><span class="n">tableName</span><span class="o">&gt;</span>
</span><span id="__span-0-3"><a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="w">    </span><span class="p">[</span><span class="k">WHERE</span><span class="w"> </span><span class="o">&lt;</span><span class="n">condition</span><span class="o">&gt;</span><span class="p">]</span>
</span><span id="__span-0-4"><a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="w">    </span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">colName</span>
</span><span id="__span-0-5"><a href="#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="w">    </span><span class="k">HAVING</span><span class="w"> </span><span class="o">&lt;</span><span class="n">aggFunc</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="n">condition</span><span class="o">&gt;</span>
</span><span id="__span-0-6"><a href="#__codelineno-0-6" id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="w">    </span><span class="p">[</span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="o">&lt;</span><span class="n">colName</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&lt;</span><span class="k">option</span><span class="o">&gt;</span><span class="p">]</span>
</span></code></pre></div>
<p><code>HAVING</code> 是用来给 <code>GROUP BY</code> 得到的东西设置限制的。</p>
<p>注意，假如有 <code>COUNT(*) AS cnt</code>，<code>HAVING</code> 里面不能写 <code>cnt</code>，还得写 <code>COUNT(*)</code>。这是一个语法问题：<code>HAVING</code> 里面必须要包含 agg 函数。</p>
<h2 id="limit"><code>LIMIT</code> 语法</h2>
<p><code>LIMIT</code> 是用来限制返回的数量的。比如不想返回全部数据，只想看前 10 行数据，就可以用 <code>LIMIT</code> 关键字（配合 <code>ORDER BY</code> 使用）。为了保证每一次相同的询问都返回同样的数据，必须配合 <code>ORDER BY</code>，也就是保持 consistency。</p>
<h2 id="constraint">限制（<code>CONSTRAINT</code>）</h2>
<p>在创建表的时候，之前已经见过关于主键的限制了。现在来介绍关于值的限制：</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-1-1"><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">&lt;</span><span class="n">tableName</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-1-2"><a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="w">    </span><span class="o">&lt;</span><span class="n">col1</span><span class="o">&gt;</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
</span><span id="__span-1-3"><a href="#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="w">    </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="o">&lt;</span><span class="n">tableName</span><span class="o">&gt;</span><span class="n">_pkey</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="o">&lt;</span><span class="n">col1</span><span class="o">&gt;</span><span class="p">),</span>
</span><span id="__span-1-4"><a href="#__codelineno-1-4" id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="w">    </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="o">&lt;</span><span class="n">consName</span><span class="o">&gt;</span><span class="w"> </span><span class="k">CHECK</span><span class="w"> </span><span class="p">(</span><span class="o">&lt;</span><span class="n">col1</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">10</span><span class="p">)</span>
</span><span id="__span-1-5"><a href="#__codelineno-1-5" id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="p">)</span>
</span></code></pre></div>
<p>像这个 <code>CREATE</code> 最后的 <code>CONSTRAINT</code> 意思就是限制这一列所有的值，必须大于 10. 如果插入、修改的时候不满足这个限制条件将会报错。</p>
</article>>